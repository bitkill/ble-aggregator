version: '3.7'


volumes:
  prometheus_volume:
  grafana_volume:

services:

  # This service, generated by running
  # ./gradlew build -Dquarkus.container-image.build=true
  ble-aggregator:
    image: rui/ble-aggregator:0.0.0-4-main
    ports:
      - "8080:8080"
      - "5005:5005" # For debug purposes only, comment out if not necessary
    environment:
      QUARKUS_PROFILE: docker
      JAVA_DEBUG: "true" # For debug purposes only, comment out if not necessary

  # Prometheus, a time series database & service
  prometheus:
    image: prom/prometheus:v2.41.0
    ports:
      - "9090:9090"
    volumes:
      - prometheus_volume:/prometheus
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    restart: unless-stopped

  # Grafana, Awesome dashboards
  grafana:
    image: grafana/grafana:9.3.2
    user: "1000" # current user
    volumes:
      - grafana_volume:/var/lib/grafana
    environment:
      GF_INSTALL_PLUGINS: grafana-clock-panel,grafana-simple-json-datasource
      # see this for some tricks: https://sensorsiot.github.io/IOTstack/Containers/Grafana/

