version: '3.7'


volumes:
  prometheus_volume:
  grafana_volume:

services:

  # This service, generated by running
  # ./gradlew build -Dquarkus.container-image.build=true
  ble-aggregator:
    image: rui/ble-aggregator:0.0.0-1-main
    ports:
      - "8080:8080"
    environment:
      QUARKUS_PROFILE: docker

  # Prometheus, a time series database & service
  prometheus:
    image: prom/prometheus:v2.30.3
    ports:
      - "9090:9090"
    volumes:
      - prometheus_volume:/prometheus
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    restart: unless-stopped

  # Grafana, Awesome dashboards
  grafana:
    image: grafana/grafana:8.2.1
    user: "1000" # current user
    volumes:
      - grafana_volume:/var/lib/grafana
    environment:
      GF_INSTALL_PLUGINS: grafana-clock-panel,grafana-simple-json-datasource
      # see this for some tricks: https://sensorsiot.github.io/IOTstack/Containers/Grafana/

